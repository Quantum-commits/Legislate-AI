import { jsPDF } from 'jspdf';

export interface DocumentData {
  type: 'FIR' | 'RTI' | 'explanation';
  content: string;
  userDetails?: {
    name?: string;
    address?: string;
    phone?: string;
  };
  language?: string;
  title?: string;
}

export const generatePDF = (data: DocumentData): jsPDF => {
  const doc = new jsPDF();
  
  // Set font (basic fonts that support ASCII characters)
  doc.setFont('helvetica');
  
  // Header
  doc.setFontSize(16);
  doc.setFont('helvetica', 'bold');
  
  const headerText = data.type === 'explanation' ? 
    (data.title || 'Document Explanation') :
    data.type === 'FIR' ? 
    (data.language === 'hi' ? 'рдкреНрд░рд╛рдердорд┐рдХреА рд░рд┐рдкреЛрд░реНрдЯ (FIR)' : 
     data.language === 'te' ? 'р░кр▒Нр░░р░╛р░ер░ор░┐р░Х р░ир░┐р░╡р▒Зр░жр░┐р░Х (FIR)' :
     data.language === 'mr' ? 'рдкреНрд░рд╛рдердорд┐рдХ рдЕрд╣рд╡рд╛рд▓ (FIR)' :
     data.language === 'kn' ? 'р▓кр│Нр▓░р▓╛р▓ер▓ор▓┐р▓Х р▓ор▓╛р▓╣р▓┐р▓др▓┐ р▓╡р▓░р▓жр▓┐ (FIR)' :
     'First Information Report (FIR)') :
    (data.language === 'hi' ? 'рд╕реВрдЪрдирд╛ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рдЖрд╡реЗрджрди (RTI)' :
     data.language === 'te' ? 'р░╕р░ор░╛р░Ър░╛р░░ р░╣р░Хр▒Нр░Хр▒Б р░жр░░р░Цр░╛р░╕р▒Нр░др▒Б (RTI)' :
     data.language === 'mr' ? 'рдорд╛рд╣рд┐рддреА рдЕрдзрд┐рдХрд╛рд░ рдЕрд░реНрдЬ (RTI)' :
     data.language === 'kn' ? 'р▓ор▓╛р▓╣р▓┐р▓др▓┐ р▓╣р▓Хр│Нр▓Хр│Б р▓Ер▓░р│Нр▓Ьр▓┐ (RTI)' :
     'Right to Information Application (RTI)');
  
  doc.text(headerText, 20, 30);
  
  // Date
  doc.setFontSize(10);
  doc.setFont('helvetica', 'normal');
  const date = new Date().toLocaleDateString();
  doc.text(`Date: ${date}`, 20, 45);
  
  // Content
  doc.setFontSize(12);
  const lines = doc.splitTextToSize(data.content, 170);
  doc.text(lines, 20, 60);
  
  // User details if provided
  if (data.userDetails) {
    const yPosition = 60 + (lines.length * 5) + 20;
    
    doc.setFont('helvetica', 'bold');
    doc.text('Applicant Details:', 20, yPosition);
    
    doc.setFont('helvetica', 'normal');
    let currentY = yPosition + 10;
    
    if (data.userDetails.name) {
      doc.text(`Name: ${data.userDetails.name}`, 20, currentY);
      currentY += 10;
    }
    
    if (data.userDetails.address) {
      const addressLines = doc.splitTextToSize(`Address: ${data.userDetails.address}`, 170);
      doc.text(addressLines, 20, currentY);
      currentY += addressLines.length * 5 + 5;
    }
    
    if (data.userDetails.phone) {
      doc.text(`Phone: ${data.userDetails.phone}`, 20, currentY);
    }
  }
  
  // Footer
  doc.setFontSize(8);
  doc.setFont('helvetica', 'italic');
  doc.text('Generated by Legislate AI - Legal Assistant', 20, 280);
  
  return doc;
};

export const downloadPDF = (data: DocumentData, filename?: string) => {
  const doc = generatePDF(data);
  const defaultFilename = `${data.type}_${new Date().toISOString().split('T')[0]}.pdf`;
  doc.save(filename || defaultFilename);
};

export const sharePDFOnWhatsApp = (data: DocumentData) => {
  // Create a simplified text version for WhatsApp sharing
  const headerText = data.type === 'FIR' ? 
    (data.language === 'hi' ? 'ЁЯПЫя╕П рдкреНрд░рд╛рдердорд┐рдХреА рд░рд┐рдкреЛрд░реНрдЯ (FIR)\n' : 
     data.language === 'te' ? 'ЁЯПЫя╕П р░кр▒Нр░░р░╛р░ер░ор░┐р░Х р░ир░┐р░╡р▒Зр░жр░┐р░Х (FIR)\n' :
     data.language === 'mr' ? 'ЁЯПЫя╕П рдкреНрд░рд╛рдердорд┐рдХ рдЕрд╣рд╡рд╛рд▓ (FIR)\n' :
     data.language === 'kn' ? 'ЁЯПЫя╕П р▓кр│Нр▓░р▓╛р▓ер▓ор▓┐р▓Х р▓ор▓╛р▓╣р▓┐р▓др▓┐ р▓╡р▓░р▓жр▓┐ (FIR)\n' :
     'ЁЯПЫя╕П First Information Report (FIR)\n') :
    (data.language === 'hi' ? 'ЁЯУЛ рд╕реВрдЪрдирд╛ рдХрд╛ рдЕрдзрд┐рдХрд╛рд░ рдЖрд╡реЗрджрди (RTI)\n' :
     data.language === 'te' ? 'ЁЯУЛ р░╕р░ор░╛р░Ър░╛р░░ р░╣р░Хр▒Нр░Хр▒Б р░жр░░р░Цр░╛р░╕р▒Нр░др▒Б (RTI)\n' :
     data.language === 'mr' ? 'ЁЯУЛ рдорд╛рд╣рд┐рддреА рдЕрдзрд┐рдХрд╛рд░ рдЕрд░реНрдЬ (RTI)\n' :
     data.language === 'kn' ? 'ЁЯУЛ р▓ор▓╛р▓╣р▓┐р▓др▓┐ р▓╣р▓Хр│Нр▓Хр│Б р▓Ер▓░р│Нр▓Ьр▓┐ (RTI)\n' :
     'ЁЯУЛ Right to Information Application (RTI)\n');
  
  const message = `${headerText}\nЁЯУЕ Date: ${new Date().toLocaleDateString()}\n\n${data.content}\n\nтЪЦя╕П Generated by Legislate AI Legal Assistant`;
  
  const encodedMessage = encodeURIComponent(message);
  const whatsappUrl = `https://wa.me/?text=${encodedMessage}`;
  
  window.open(whatsappUrl, '_blank');
};